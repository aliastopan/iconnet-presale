@attribute [Route(PageRoute.CrmImportVerification)]
@inherits CrmVerificationPageBase
@rendermode InteractiveServer

<PageTitle>Verifikasi CRM</PageTitle>

<div class="d-flex flex-row align-items-center">
    <FluentLabel Typo="Typography.H3" MarginBlock="0.5rem">Verifikasi CRM</FluentLabel>
    <div class="filter-toggle">
        <FluentButton Appearance="Appearance.Lightweight">Filter</FluentButton>
    </div>
</div>
<div>
    @if (!IsLoading)
    {
        <span class="page-description">Verifikasi hasil import iCRM+</span>
    }
    else
    {
        <div class="d-flex flex-row align-items-center">
            <span class="px-1">Updating</span>
            <FluentProgressRing  style="width: 14px; height: 14px;"></FluentProgressRing>
        </div>
    }
</div>
<div>
    <WorkloadFilterForm @ref="FilterComponent"
        OnFilter="@(this.StateHasChanged)" />
</div>
<div class="datagrid-wrapper">
    @if (WorkPapers is not null)
    {
        <FluentDataGrid Items="@WorkPapers"
            TGridItem="WorkPaper"
            Virtualize="true"
            Pagination="@Pagination"
            ItemSize="32"
            OnRowFocus="@OnRowSelected"
            EmptyContent="@HtmlFragment.EmptyContent"
            GridTemplateColumns="@GridTemplateCols">

            <TemplateColumn Title="ID PERMOHONAN" SortBy="@SortByIdPermohonan" Style="@GetWidthStyle(ColumnWidth.IdPermohonanPx)">
                <ColumnOptions>
                    <div class="search-box">
                        @if (FilterComponent is not null)
                        {
                            <FluentSearch Autofocus=true
                                style="width: 200px;"
                                type="search"
                                @bind-Value=FilterComponent.Filter.IdPermohonan
                                @oninput="FilterComponent.Filter.IdPermohonanFilterHandler"
                                @bind-Value:after="FilterComponent.Filter.IdPermohonanFilterClear"
                                Placeholder="Id Permohonan"/>
                        }
                    </div>
                </ColumnOptions>
                <ChildContent>
                    <div class="">
                        @context.ApprovalOpportunity.IdPermohonan
                    </div>
                </ChildContent>
            </TemplateColumn>
            <TemplateColumn Title="TGL PERMOHONAN" Style="@GetWidthStyle(ColumnWidth.TglPermohonanPx)">
                <div class="">
                    @context.ApprovalOpportunity.TglPermohonan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="PAC IMPORT" Style="@GetWidthStyle(ColumnWidth.ImportSignaturePx)">
                <div class="">
                    @context.ApprovalOpportunity.ImportSignature.Alias
                </div>
            </TemplateColumn>
            <TemplateColumn Title="DURASI TIDAK LANJUT" Style="@GetWidthStyle(ColumnWidth.DurasiTidakLanjutPx)">
                <div class="">
                    @DateTimeService.GetElapsedTime(context.ApprovalOpportunity.TglPermohonan).AsReadableDateTime()
                </div>
            </TemplateColumn>
            <TemplateColumn Title="NAMA PEMOHON" Style="@GetWidthStyle(ColumnWidth.NamaPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.NamaLengkap
                </div>
            </TemplateColumn>
            <TemplateColumn Title="ID PLN" Style="@GetWidthStyle(ColumnWidth.IdPlnPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.IdPln
                </div>
            </TemplateColumn>
            <TemplateColumn Title="LAYANAN" Style="@GetWidthStyle(ColumnWidth.LayananPx)">
                <div class="">
                    @context.ApprovalOpportunity.Layanan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="SUMBER PERMOHONAN" Style="@GetWidthStyle(ColumnWidth.SumberPermohonanPx)">
                <div class="">
                    @context.ApprovalOpportunity.SumberPermohonan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="STATUS PERMOHONAN" Style="@GetWidthStyle(ColumnWidth.StatusPermohonanPx)">
                <div class="">
                    @context.ApprovalOpportunity.StatusPermohonan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="NAMA AGEN" Style="@GetWidthStyle(ColumnWidth.NamaAgenPx)">
                <div class="">
                    @context.ApprovalOpportunity.Agen.NamaLengkap
                </div>
            </TemplateColumn>
            <TemplateColumn Title="EMAIL AGEN" Style="@GetWidthStyle(ColumnWidth.EmailAgenPx)">
                <div class="">
                    @context.ApprovalOpportunity.Agen.Email
                </div>
            </TemplateColumn>
            <TemplateColumn Title="TELP. AGEN" Style="@GetWidthStyle(ColumnWidth.TelpAgenPx)">
                <div class="">
                    @context.ApprovalOpportunity.Agen.NomorTelepon
                </div>
            </TemplateColumn>
            <TemplateColumn Title="MITRA AGEN" Style="@GetWidthStyle(ColumnWidth.MitraAgenPx)">
                <div class="">
                    @context.ApprovalOpportunity.Agen.Mitra
                </div>
            </TemplateColumn>
            <TemplateColumn Title="SPLITTER" Style="@GetWidthStyle(ColumnWidth.SplitterPx)">
                <div class="">
                    @context.ApprovalOpportunity.Splitter
                </div>
            </TemplateColumn>
            <TemplateColumn Title="JENIS PERMOHONAN" Style="@GetWidthStyle(ColumnWidth.JenisPermohonanPx)">
                <div class="">
                    @context.ApprovalOpportunity.JenisPermohonan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="TELP. PEMOHON" Style="@GetWidthStyle(ColumnWidth.TelpPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.NomorTelepon
                </div>
            </TemplateColumn>
            <TemplateColumn Title="EMAIL PEMOHON" Style="@GetWidthStyle(ColumnWidth.EmailPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.Email
                </div>
            </TemplateColumn>
            <TemplateColumn Title="NIK PEMOHON" Style="@GetWidthStyle(ColumnWidth.NikPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.Nik
                </div>
            </TemplateColumn>
            <TemplateColumn Title="NPWP PEMOHON" Style="@GetWidthStyle(ColumnWidth.NpwpPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.Npwp
                </div>
            </TemplateColumn>
            <TemplateColumn Title="KETERANGAN" Style="@GetWidthStyle(ColumnWidth.KeteranganPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.Keterangan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="ALAMAT PEMOHON" Style="@GetWidthStyle(ColumnWidth.AlamatPemohonPx)">
                <div class="">
                    @context.ApprovalOpportunity.Pemohon.Alamat
                </div>
            </TemplateColumn>
            <TemplateColumn Title="REGIONAL" Style="@GetWidthStyle(ColumnWidth.RegionalPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Bagian
                </div>
            </TemplateColumn>
            <TemplateColumn Title="KANTOR PERWAKILAN" Style="@GetWidthStyle(ColumnWidth.KantorPerwakilanPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.KantorPerwakilan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="PROVINSI" Style="@GetWidthStyle(ColumnWidth.ProvinsiPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Provinsi
                </div>
            </TemplateColumn>
            <TemplateColumn Title="KABUPATEN" Style="@GetWidthStyle(ColumnWidth.KabupatenPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Kabupaten
                </div>
            </TemplateColumn>
            <TemplateColumn Title="KECAMATAN" Style="@GetWidthStyle(ColumnWidth.KecamatanPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Kecamatan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="KELURAHAN" Style="@GetWidthStyle(ColumnWidth.KelurahanPx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Kelurahan
                </div>
            </TemplateColumn>
            <TemplateColumn Title="LATITUDE" Style="@GetWidthStyle(ColumnWidth.LatitudePx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Koordinat.Latitude
                </div>
            </TemplateColumn>
            <TemplateColumn Title="LONGITUDE" Style="@GetWidthStyle(ColumnWidth.LongitudePx)">
                <div class="">
                    @context.ApprovalOpportunity.Regional.Koordinat.Longitude
                </div>
            </TemplateColumn>
        </FluentDataGrid>
    }
    else
    {
        <span>Loading...</span>
    }
</div>

<FluentPaginator State="@Pagination">
    <SummaryTemplate>
        Terdapat <strong>@(Pagination.TotalItemCount ?? 0)</strong> baris
    </SummaryTemplate>
    <PaginationTextTemplate>
        Hal. <strong>@(Pagination.CurrentPageIndex + 1)</strong> dari <strong>@(Pagination.LastPageIndex + 1)</strong> halaman
    </PaginationTextTemplate>
</FluentPaginator>
